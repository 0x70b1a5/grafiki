<%= form_for @bounty do |f| %>
  <% if @bounty.errors.any? %>
    <%= pluralize(@bounty.errors.count, "error") %> must be fixed. 
    <ul> 
      <% @bounty.errors.full_messages.each do |m| %>
        <li><%= m %></li>
      <% end %>
    </ul>
  <% end %>

  <div class="box">
  <div class="in-float">
    <%= f.label :title %>
    <%= f.text_field :title, placeholder: 'name your bounty' %>
  </div>
  </div>

  <div class="box">
  <div class="in-float" id="b-f-d">
    <%= f.label :description %>
    <%= f.text_area :description, 
      placeholder: 'a summary of the art you want, and details about where you want it.' %>
  </div>
  </div>

  <div class="box">
  <div class="in-float">
    <%= f.label :location %>
    <%= f.number_field :lat, :class => 'text_field', :step => 0.000001, placeholder: 'latitude' %>
    <%= f.number_field :lng, :class => 'text_field', :step => 0.000001, placeholder: 'longitude' %>
  </div>
  </div>

  <div class="box">
  <div class="in-float">
    <%= f.label :amount %>
    <%= f.number_field :amount, :class => 'text_field', :step => 0.000001, placeholder: 'artist reward (btc)' %>
  </div>
  </div>

  <div class="box">
  <div class="in-float">
    <%= f.label :patron %>
    <%= f.text_field :patron, placeholder: 'your name (optional)',
      style: "min-width: 400px" %>
  </div>
  </div>

  <input name="stripeToken" id="stripeToken" style="display: none" type="text">
  <input name="stripeEmail" id="stripeEmail" style="display: none" type="text">
  <input name="stripeTokenType" id="stripeTokenType" style="display: none" type="text">

  <button id="customButton">Purchase</button>

<% end %>

<script src="https://checkout.stripe.com/checkout.js"></script>

<script>
  function getAmt(){
   return Number($( "#bounty_amount" ).val()) * 100
  };

  var handler = StripeCheckout.configure({
    key: 'pk_test_S27ParIaigJWMsagC3SAFiFG',
    image: 'https://stripe.com/img/documentation/checkout/marketplace.png',
    locale: 'auto',
    bitcoin: true,
    token: function(token) {
      $( "#stripeEmail" ).val( token.email );
      $( "#stripeToken" ).val( token.id );
      $( "#stripeTokenType" ).val( token.type );
      $( "#new_bounty" ).submit()
    }
  });

  $('#customButton').on('click', function(e) {
    // Open Checkout with further options:
    handler.open({
      name: 'Demo Site',
      description: '2 widgets',
      amount: getAmt()
    });
    e.preventDefault();
  });

  // Close Checkout on page navigation:
  $(window).on('popstate', function() {
    handler.close();
  });
</script>

